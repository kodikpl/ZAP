<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZAPTV</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar for the channel list (a nice touch for dark themes) */
        #channel-list::-webkit-scrollbar {
            width: 8px;
        }
        #channel-list::-webkit-scrollbar-thumb {
            background-color: #a78bfa; /* Purple-400 */
            border-radius: 4px;
        }
        #channel-list::-webkit-scrollbar-track {
            background: #1f2937; /* Gray-800 */
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Ensure the iframe fills its container and maintains aspect ratio */
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            overflow: hidden;
            background-color: #000;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }
        .channel-item.active {
            border-left: 4px solid #a78bfa; /* Purple-400 */
            background-color: #374151; /* Gray-700 */
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-100 min-h-screen">

    <div id="app" class="max-w-7xl mx-auto p-4 md:p-6">

        <!-- Header (Updated Logo: Square Z + ZAPTV text) -->
        <!-- Adjusted classes for smaller size (py-3, mb-4, text-2xl/text-xl) -->
        <header class="flex justify-between items-center py-3 border-b border-purple-800 mb-4">
            <div class="flex items-center space-x-2">
                <!-- NOW USING IMG TAG FOR THE HEADER LOGO, PULLED FROM JAVASCRIPT -->
                <img id="header-logo" class="w-8 h-8 rounded-md object-cover flex-shrink-0" src="" alt="ZAPTV Logo">
                
                <!-- ZAPTV Text -->
                <h1 class="text-2xl font-extrabold text-purple-400 tracking-wider">ZAPTV</h1>
            </div>
            <nav class="hidden sm:flex space-x-4 text-gray-400 text-sm font-medium">
                <a href="/" class="hover:text-purple-400 transition">Home</a>
                <a href="/channels.html" class="hover:text-purple-400 transition">Channels</a>
                <a href="info.html" class="hover:text-purple-400 transition">Info</a>
            </nav>
        </header>

        <!-- Main Content Grid -->
        <!-- Grid changed from lg:grid-cols-3 to lg:grid-cols-4 for bigger player -->
        <main class="grid grid-cols-1 lg:grid-cols-4 gap-6">

            <!-- Left/Center: Video Player & Description -->
            <!-- Column span changed from lg:col-span-2 to lg:col-span-3 for bigger player -->
            <div class="lg:col-span-3 space-y-6">

                <!-- Widescreen Iframe Player -->
                <div class="bg-gray-800 rounded-xl shadow-2xl overflow-hidden transform transition-all duration-300">
                    <div class="video-container">
                        <!-- The iframe source will be updated by JavaScript -->
                        <iframe id="video-player"
                            src=""
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen
                            sandbox="allow-scripts allow-same-origin allow-presentation allow-popups">
                        </iframe>
                    </div>
                </div>

                <!-- Channel Info Panel -->
                <div class="bg-gray-800 p-5 rounded-xl border border-gray-700 shadow-lg">
                    <div class="flex items-start space-x-4 mb-3">
                        <!-- Logo now uses rounded-md -->
                        <img id="channel-image-lg" class="w-16 h-16 rounded-md object-cover flex-shrink-0 border-2 border-purple-600" src="" alt="Channel Logo">
                        <div>
                            <h2 id="channel-name" class="text-3xl font-bold text-white mb-1"></h2>
                            <p id="channel-category" class="text-sm font-medium text-purple-400"></p>
                        </div>
                    </div>
                    <p id="channel-description" class="text-gray-400 leading-relaxed pt-3 border-t border-gray-700 mt-2"></p>
                </div>
            </div>

            <!-- Right: Channel List (with Filters) -->
            <div class="lg:col-span-1">
                <div class="bg-gray-800 rounded-xl p-4 shadow-2xl h-full flex flex-col">
                    <!-- Removed H3 "All Channels" text -->
                    
                    <!-- Category Filters -->
                    <div id="category-filters" class="flex flex-wrap gap-2 mb-4 text-xs font-medium">
                        <!-- Buttons will be injected here by JavaScript -->
                    </div>

                    <!-- Channel List Container -->
                    <div id="channel-list" class="space-y-2 overflow-y-auto max-h-[80vh] lg:max-h-[70vh]">
                        <!-- Channel items will be injected here by JavaScript -->
                        <p class="text-gray-500 p-4 text-center">Loading channels...</p>
                    </div>
                </div>
            </div>

        </main>
        
        <!-- Footer added as requested -->
        <footer class="mt-8 py-4 border-t border-purple-800 text-center text-gray-500 text-sm">
            <p>&copy; 2025 ZAPTV. All rights reserved. | Simple Online Channel Viewer</p>
            <p class="mt-1">Built with Tailwind CSS for a responsive, modern experience.</p>
        </footer>
    </div>

    <script>
        // Placeholder image generator function
        const getPlaceholderImageUrl = (name, size = '64x64') => {
            // Uses placehold.co to generate a square image with a background color and text
            const safeName = name.toUpperCase().substring(0, 3);
            return `https://placehold.co/${size}/9333ea/fefefe?text=${safeName}&font=inter&bold=true`;
        };

        // NEW: Generate the specific ZAPTV logo image URL for the header
        const ZAP_LOGO_URL = getPlaceholderImageUrl('Z', '50x70');

        // --- CHANNEL DATA ---
        const CHANNELS = [
            { 
            id: 1, 
            name: "BFDI TV", 
            description: "Twenty characters battle for a luxurious island in an elimination-centric viewer-voted animated series, including BFDI (Battle for Dream Island), BFDIA (Battle for Dream Island AGAIN), IDFB, and BFB (Battle for B.F.D.I.).", 
            url: "//naplet.space/ytlives/jnj", 
            category: "cat", 
            image: "https://yt3.googleusercontent.com/ytc/AIdro_lDRSXSQutngc-vP4RyLRSuRSRlJYxWJTFwVoaQVD0Hja4=s176-c-k-c0x00ffffff-no-rj-mo"
            },
            
            { 
            id: 2, 
            name: "Logi TV Catcast", 
            description: "Twenty characters battle for a luxurious island in an elimination-centric viewer-voted animated series, including BFDI (Battle for Dream Island), BFDIA (Battle for Dream Island AGAIN), IDFB, and BFB (Battle for B.F.D.I.).", 
            url: "https://catcast.tv/player/49819", 
            category: "cat", 
            image: "https://img.catcast.tv/uploads/01112025/logos/49819-6905f6f65d78e.png"
            },
            
            //             { 
            //id: 1, 
            //name: "BFDI TV", 
            //description: "Hello!", 
            //url: "//naplet.space/ytlives/jnj", 
            //category: "cat", 
            //image: "getPlaceholderImageUrl("logo") "
            //},
            //
        ];

        let activeChannelId = 1;
        let currentCategoryFilter = 'All'; // New state for filtering

        /**
         * Finds a channel by its ID.
         * @param {number} id The ID of the channel to find.
         * @returns {object|null} The channel object or null.
         */
        const getChannelById = (id) => CHANNELS.find(c => c.id === id) || null;

        /**
         * Handles the filtering of channels and updates the UI state.
         * @param {string} category The category to filter by ('All' for no filter).
         */
        const filterChannels = (category) => {
            currentCategoryFilter = category;
            
            // 1. Update button active state
            document.querySelectorAll('#category-filters button').forEach(btn => {
                btn.classList.remove('bg-purple-600', 'text-white');
                btn.classList.add('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
                if (btn.textContent === category) {
                    btn.classList.add('bg-purple-600', 'text-white');
                    btn.classList.remove('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
                }
            });

            // 2. Re-render the list based on the new filter
            renderChannelList();

            // 3. Ensure a channel is selected (if the previously selected one is now hidden)
            const filteredChannels = CHANNELS.filter(channel => 
                currentCategoryFilter === 'All' || channel.category === currentCategoryFilter
            );
            
            // If the active channel is still in the filtered list, do nothing.
            if (!filteredChannels.some(c => c.id === activeChannelId) && filteredChannels.length > 0) {
                // Otherwise, load the first channel in the new filtered list.
                loadChannel(filteredChannels[0].id);
            } else if (filteredChannels.length === 0) {
                 // Clear player if no channels are left
                 document.getElementById('video-player').src = '';
                 document.getElementById('channel-name').textContent = 'No Channel Selected';
                 document.getElementById('channel-description').textContent = 'Please choose a different category.';
                 document.getElementById('channel-category').textContent = '';
                 document.getElementById('channel-image-lg').src = getPlaceholderImageUrl("ZAP");
            }
        };


        /**
         * Updates the UI (iframe, name, description) for the selected channel.
         * @param {number} id The ID of the channel to load.
         */
        const loadChannel = (id) => {
            const channel = getChannelById(id);
            if (!channel) {
                console.error(`Channel with ID ${id} not found.`);
                return;
            }

            activeChannelId = id;

            // 1. Update the iframe source
            document.getElementById('video-player').src = channel.url;

            // 2. Update the info panel (Image and enhanced data)
            document.getElementById('channel-name').textContent = channel.name;
            document.getElementById('channel-description').textContent = channel.description;
            document.getElementById('channel-category').textContent = channel.category;
            // Update the main info panel image
            document.getElementById('channel-image-lg').src = channel.image;

            // 3. Update active state in the channel list
            document.querySelectorAll('.channel-item').forEach(item => {
                item.classList.remove('active');
            });
            const activeItem = document.getElementById(`channel-${id}`);
            if (activeItem) {
                activeItem.classList.add('active');
                // Scroll to active item if needed (UX enhancement)
                activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }

            // 4. Update the URL without reloading (Deep linking feature)
            // FIX: Using window.location.hash instead of history.replaceState to avoid SecurityError
            window.location.hash = `id=${id}`;
        };

        /**
         * Renders the filter buttons based on unique channel categories.
         */
        const renderFilterButtons = () => {
            const categories = ['All', ...new Set(CHANNELS.map(c => c.category))];
            const filterContainer = document.getElementById('category-filters');
            filterContainer.innerHTML = '';

            categories.forEach(category => {
                const button = document.createElement('button');
                const isActive = category === currentCategoryFilter;
                button.textContent = category;
                button.className = `px-3 py-1 rounded-full transition duration-150 whitespace-nowrap ${
                    isActive ? 'bg-purple-600 text-white' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                }`;
                // Set the onclick handler to the new filter function
                button.onclick = () => filterChannels(category);
                filterContainer.appendChild(button);
            });
        };

        /**
         * Renders the channel list in the sidebar based on the current filter.
         */
        const renderChannelList = () => {
            const listContainer = document.getElementById('channel-list');
            listContainer.innerHTML = ''; // Clear existing content

            const filteredChannels = CHANNELS.filter(channel => 
                currentCategoryFilter === 'All' || channel.category === currentCategoryFilter
            );

            if (filteredChannels.length === 0) {
                listContainer.innerHTML = '<p class="text-gray-500 p-4 text-center">No channels found in this category.</p>';
                return;
            }

            filteredChannels.forEach(channel => {
                const item = document.createElement('div');
                item.id = `channel-${channel.id}`;
                // Apply 'active' class only if the channel is the currently playing one
                const isActiveClass = channel.id === activeChannelId ? 'active' : '';
                item.className = `channel-item flex items-center p-3 rounded-xl cursor-pointer transition duration-200 hover:bg-gray-700 border border-transparent ${isActiveClass}`;
                item.setAttribute('onclick', `loadChannel(${channel.id})`);

                // Uses the image tag for the logo 
                item.innerHTML = `
                    <img src="${channel.image}" 
                         onerror="this.onerror=null; this.src='${getPlaceholderImageUrl(channel.name)}'"
                         alt="${channel.name} logo" 
                         class="w-10 h-10 mr-3 rounded-md object-cover flex-shrink-0">
                    <div class="flex-grow">
                        <p class="text-sm font-semibold text-white">${channel.name}</p>
                        <p class="text-xs text-gray-400">${channel.category}</p>
                    </div>
                `;
                listContainer.appendChild(item);
            });
        };

        /**
         * Initialization function.
         */
        const init = () => {
            // Set the header logo source
            document.getElementById('header-logo').src = ZAP_LOGO_URL;
            
            // Read URL for initial channel ID from the URL HASH
            const hash = window.location.hash;
            let initialChannelId = 1; // Default to Channel 1

            if (hash.startsWith('#id=')) {
                // Extract the ID from the hash (e.g., from #id=5)
                const requestedId = parseInt(hash.substring(4));
                if (!isNaN(requestedId) && getChannelById(requestedId)) {
                    initialChannelId = requestedId;
                }
            }

            // Load the initial channel first to set activeChannelId and video player
            loadChannel(initialChannelId);

            // Now render the filters and channel list based on the active channel
            renderFilterButtons();
            renderChannelList(); 
        };

        // Add a listener for hash changes (e.g., if a user uses the back/forward browser buttons)
        window.addEventListener('hashchange', () => {
            const hash = window.location.hash;
            if (hash.startsWith('#id=')) {
                const newId = parseInt(hash.substring(4));
                // Only load if the ID is valid and different from the current active one
                if (!isNaN(newId) && newId !== activeChannelId && getChannelById(newId)) {
                    loadChannel(newId);
                }
            }
        });

        // Initialize the app when the DOM is ready
        window.onload = init;
    </script>
</body>
</html>
